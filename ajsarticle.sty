%% 産業技術大学院大学紀要LaTeXスタイルシート
%% Y.Chubachi 2012,2013

%% 参考
%% http://ea3pch.yz.yamagata-u.ac.jp/member/sumio/tex/styleuse.pdf

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 版面と余白
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% 版面（A4）210mm×297mm
%      | 版面(A) | 用紙(B) | 余白計(A-B)
% -------------------------------------
% 幅   | 168  mm |   210mm |       42mm
% 高さ | 244.5mm |   297mm |       48mm ※
% -------------------------------------

% 余白
% ---------------------
% 天（上余白）    | 27.75mm
% 地（下余白）    | 27.75mm ※
% ノド（内側余白）| 25mm
% 小口（外側余白）| 17mm
% ---------------------

% ※高さの補正
%   高さは\baselineskipの整数倍＋\topskipに補正しする．
%   この補正により，footnoteの下側が揃う（しないとはみ出る）．
%242mmほどになる．

\usepackage[
%  top=27.75truemm,
  inner=24truemm,
  textwidth=168truemm,
  textheight=244.5truemm,
  heightrounded,      % ※高さの補正
  centering,
  dvipdfm]{geometry}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% パッケージ
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{nlines} % 行取り用パッケージ（自作）

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% ページ番号
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pagestyle{empty}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% タイトルの定義
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% 概要とキーワードの横幅を指定
\newlength{\abstractwidth}
\setlength{\abstractwidth}{46zw} % 56字-5字-5字=46字

\newcommand*{\keywords}[1]{\gdef\@keywords{#1}}	% キーワード
\newcommand*{\etitle}[1]{\gdef\@etitle{#1}}	% 英文表題
\newcommand*{\eauthor}[1]{\gdef\@eauthor{#1}}	% 英文著者名

%% 概要を登録するための命令を定義
\renewenvironment{abstract}
  %% 概要環境の開始
  {
    \global\setbox\@abstractbox\hbox\bgroup % 次の\egroupまでをboxに登録
    \begin{minipage}[b]{\abstractwidth} % ミニページの幅を設定
    \nlines{\large\centering \textbf{Abstract}\par} % 概要の表題
    \small     
  }
  %% 概要環境の終了
  {
    \end{minipage}\egroup
  }

%
% \maketitleを再定義します
%
\renewcommand{\maketitle}{\par
  \begingroup
    %% thanksのためのfootnoteの書式
    \setcounter{footnote}{1}		% thanksの番号を1(=2)から開始
    \renewcommand\thefootnote{\@fnsymbol\c@footnote} % 番号の書式
    %% 表題につけるマークの書式
    \def\@makefnmark{%
      \rlap{%!!				% 右側の文字に重ね書き
        \@textsuperscript{\normalfont\@thefnmark}
      }%!!
      \hskip 1zw			% 右側に空白文字
    }
    %% 脚注につけるマークの書式
    \long\def\@makefntext##1{
      \advance\leftskip 3zw		% fnの左余白
      \parindent 1zw\noindent
      \llap{				% 左側の文字に重ね書き
        %% footnoteの出力
        \@textsuperscript{		% 上付き文字
	  \normalfont\@thefnmark}%!!	% マークの出力
	  \hskip0.3zw}%!!		% マークと内容の間隔
	##1				% 内容
      }
    %% タイトルを出力
    \twocolumn[
      \@maketitle			% タイトルを出力
      \vskip 0.5\baselineskip		% ※twocolumn後の空白を調整
    ]
    \@thanks % 所属をfootnoteに出力
    %% footnote番号の設定
    \setcounter{footnote}{0}		% footnote番号を再初期化します
    %% ページ番号の制御
    \plainifnotempty			% ページ番号の出力を設定
  \endgroup
  \global\let\thanks\relax
  \global\let\maketitle\relax
  \global\let\@thanks\@empty
  \global\let\@author\@empty
  \global\let\@etitle\@empty		% 英文表題の変数を空にする
  \global\let\@eauthor\@empty		% 英文著者名の変数を空にする
  \global\let\title\relax
  \global\let\author\relax
  \global\let\etitle\relax		% 英文表題の命令を削除する
  \global\let\eauthor\relax		% 英文著者名の命令を削除する
  \global\let\and\relax}

% 標題全体を出力します
\def\@maketitle{%
  \let\footnote\thanks			% TODO: いらない？
  \begin{center}
    %% 和文標題
    \ifx\@title\@undefined\else
      \vskip\baselineskip % 1行あき
      \nlines{\LARGE \@title \par}
    \fi
    %Y 和文著者名
    \ifx\@author\@undefined\else
      \vskip\baselineskip % 1行あき
      \nlines{\Large \@author \par}
    \fi
    %% 英文標題
    \ifx\@etitle\@undefined\else
      \vskip\baselineskip % 1行あき
      \nlines{\LARGE \@etitle \par}
    \fi
    %% 英文著者名
    \ifx\@eauthor\@undefined\else
      \vskip\baselineskip % 1行あき
      \nlines{\large \@eauthor}
    \fi
    %% 概要
    \ifx\@abstractbox\@undefined\else
      \vskip\baselineskip		% 1行あき
      \nlines{\centerline{\box\@abstractbox}}	% 概要の内容
    \fi
    %% キーワード
    \ifx\@keywords\@undefined\else
      \nlines{%!!
        \parbox
          {\abstractwidth}
          {\textbf{Keywords:} \@keywords}
      }
    \fi
  \end{center}
}

% % 受付日を出力するための命令定義です
% \newcommand*{\receivedon}[1]{\gdef\@receivedon{#1}}
% \newcommand*{\makereceivedon}{
%   \footnotetext{\hspace{-4.5ex} Received on \@receivedon.}
% }

%%
%% \thanksのマークだけを出力するコマンド
%%
\newcommand{\thanksmark}[1][1]{
  \newcount \n
  \n = #1
  \advance \n by 1
  \footnotemark[\n]
}