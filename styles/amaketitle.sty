%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% タイトルの定義
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand*{\etitle}[1]{\gdef\@etitle{#1}}	% 英文表題
\newcommand*{\eauthor}[1]{\gdef\@eauthor{#1}}	% 英文著者名
\newcommand*{\keywords}[1]{\gdef\@keywords{#1}}	% キーワード
\newlength{\abstractwidth}			% 概要の横幅

%% 概要を登録するための命令を定義
\renewenvironment{abstract}
  %% 概要環境の開始
  {
    \global\setbox\@abstractbox\hbox\bgroup % 次の\egroupまでをboxに登録
    \begin{minipage}[b]{\abstractwidth} % ミニページの幅を設定
    \nlines{\large\centering \textbf{Abstract}\par} % 概要の表題
    \small     
  }
  %% 概要環境の終了
  {
    \end{minipage}\egroup
  }

%
% \maketitleを再定義
%
\renewcommand{\maketitle}{\par
  \begingroup
    %% thanksのためのfootnoteの書式
    \renewcommand\thefootnote{\arabic{footnote})} % 番号の書式 ex: 1)
    %% 著者名で所属を参照する記号の書式
    \def\@makefnmark{%
      \rlap{%!!				% 右側の文字に重ね書き
        \@textsuperscript{\normalfont\@thefnmark}
      }%!!
      \hskip 1zw			% 右側に空白文字
    }
    %% タイトルを出力
    \twocolumn[
      \@maketitle			% タイトルを出力
      \vskip 0.5\baselineskip		% ※twocolumn後の空白を調整
    ]
    %% 脚注の出力
    \makereceivedon			% 受領日を脚注に出力
    \@thanks				% 所属をfootnoteに出力
    %% footnote番号の設定
    \setcounter{footnote}{0}		% footnote番号を再初期化します
    %% ページ番号の制御
    \plainifnotempty			% ページ番号の出力を設定
  \endgroup
  \global\let\thanks\relax
  \global\let\maketitle\relax
  \global\let\@thanks\@empty
  \global\let\@author\@empty
  \global\let\@etitle\@empty		% 英文表題の変数を空にする
  \global\let\@eauthor\@empty		% 英文著者名の変数を空にする
  \global\let\title\relax
  \global\let\author\relax
  \global\let\etitle\relax		% 英文表題の命令を削除する
  \global\let\eauthor\relax		% 英文著者名の命令を削除する
  \global\let\and\relax}

% 標題全体を出力します
\def\@maketitle{%
  \let\footnote\thanks			% TODO: いらない？
  \begin{center}
    %% 和文標題
    \ifx\@title\@undefined\else
      \vskip\baselineskip % 1行あき
      \nlines{\LARGE \@title \par}
    \fi
    %Y 和文著者名
    \ifx\@author\@undefined\else
      \vskip\baselineskip % 1行あき
      \nlines{\Large \@author \par}
    \fi
    %% 英文標題
    \ifx\@etitle\@undefined\else
      \vskip\baselineskip % 1行あき
      \nlines{\LARGE \@etitle \par}
    \fi
    %% 英文著者名
    \ifx\@eauthor\@undefined\else
      \vskip\baselineskip % 1行あき
      \nlines{\large \@eauthor}
    \fi
    %% 概要
    \ifx\@abstractbox\@undefined\else
      \vskip\baselineskip		% 1行あき
      \nlines{\centerline{\box\@abstractbox}}	% 概要の内容
    \fi
    %% キーワード
    \ifx\@keywords\@undefined\else
      \nlines{%!!
        \parbox
          {\abstractwidth}
          {\textbf{Keywords:} \@keywords}
      }
    \fi
  \end{center}
  %% 所属
  \makereceivedon
}

%% \thanksのマークだけを出力するコマンド
\newcommand{\thanksmark}[1][1]{%!!
  \footnotemark[#1]
}

% 受付日を出力するための命令定義
\newcommand*{\receivedon}[1]{\gdef\@receivedon{#1}}
\newcommand*{\makereceivedon}{
  \begingroup
    \renewcommand\thefootnote{} % 番号の書式を付けない
    \footnotetext{Received on \@receivedon.}
  \endgroup
}
